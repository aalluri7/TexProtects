

<!DOCTYPE html>
<!--
  Copyright 2011 Google Inc. All Rights Reserved.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
  <style>
	   #mapbox {
        margin: auto;
        width: 60%;
        padding: 10px;
    }
    #map-canvas { width:500px; height:400px; }
    .layer-wizard-search-label { font-family: sans-serif };
  </style>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="UTF-8">

    <title>Fusion Tables Layer Example: Dynamic Styling with Legend</title>

    <link href="https://developers.google.com/fusiontables/docs/samples/style/default.css"
        rel="stylesheet" type="text/css">
    <style type="text/css">
      #legend {
        background-color: #FFF;
        margin: 10px;
        padding: 5px;
        width: 150px;
      }

      #legend p {
        font-weight: bold;
        margin-top: 3px;
      }

      #legend div {
        clear: both;
      }

      .color {
        height: 12px;
        width: 12px;
        margin-right: 3px;
        float: left;
        display: block;
      }
    </style>
    <script type="text/javascript"
        src="https://maps.google.com/maps/api/js?sensor=false"></script>

    <script type="text/javascript">
      /**
       * Column names mapped to a style rule.
       * @type {Object}
       * @const
       */
      var COLUMN_STYLES = {
        'Rank Order of Means (Overall Risk Ranking)': [
          {
            'min': 0,
            'max': 500,
            'color': '#FE7276'
          },
          {
            'min': 500,
            'max': 1000,
            'color': '#FE3F44'
          },
          {
            'min': 1000,
            'max': 1500,
            'color': '#BE2F33'
          },
          {
            'min': 1500,
            'max': 2000,
            'color': '#A40004'
          }
        ],
        'Mean of Rankings (all)': [
          {
            'min': 0,
            'max': 500,
            'color': '#717BD8',
            'opacity': 0.7
          },
          {
            'min': 500,
            'max': 1000,
            'color': '#2E3784',
            'opacity': 0.7
          },
          {
            'min': 1000,
            'max': 1500,
            'color': '#081272',
            'opacity': 0.7
          }
        ],
        'Total Population Estimate': [
          {
            'min': 0,
            'max': 500,
            'color': '#717BD8',
            'opacity': 0.7
          },
          {
            'min': 500,
            'max': 1000,
            'color': '#2E3784',
            'opacity': 0.7
          },
          {
            'min': 1000,
            'max': 1500,
            'color': '#081272',
            'opacity': 0.7
          }
        ],
        'Total Estimated Children 5 and Under': [
          {
            'min': 0,
            'max': 500,
            'color': '#717BD8',
            'opacity': 0.7
          },
          {
            'min': 500,
            'max': 1000,
            'color': '#2E3784',
            'opacity': 0.7
          },
          {
            'min': 1000,
            'max': 1500,
            'color': '#081272',
            'opacity': 0.7
          }
        ],
        'Children 5 and under in poverty': [
          {
            'min': 0,
            'max': 500,
            'color': '#717BD8',
            'opacity': 0.7
          },
          {
            'min': 500,
            'max': 1000,
            'color': '#2E3784',
            'opacity': 0.7
          },
          {
            'min': 1000,
            'max': 1500,
            'color': '#081272',
            'opacity': 0.7
          }
        ],
        'No Birth and Unmarried': [
          {
            'min': 0,
            'max': 500,
            'color': '#717BD8',
            'opacity': 0.7
          },
          {
            'min': 500,
            'max': 1000,
            'color': '#2E3784',
            'opacity': 0.7
          },
          {
            'min': 1000,
            'max': 1500,
            'color': '#081272',
            'opacity': 0.7
          }
        ]
      };

      function initialize() {
		   geocoder = new google.maps.Geocoder();
         map = new google.maps.Map(document.getElementById('map-canvas'), {
          center: new google.maps.LatLng(31.1, -98.5),
          zoom: 6,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        });

        layer = new google.maps.FusionTablesLayer({
          query: {
            select: 'geometry',
            from: '1-saIAOXhsY3Sc6WPvYL5SsJ_U0S94OerpG-Wt6tq'
			  
          }
        });
        layer.setMap(map);

        initSelectmenu();
        for (column in COLUMN_STYLES) {
          break;
        }
        applyStyle(map, layer, column);
        addLegend(map);

        google.maps.event.addDomListener(document.getElementById('selector'),
            'change', function() {
              var selectedColumn = this.value;
              applyStyle(map, layer, selectedColumn);
              updateLegend(selectedColumn);
        });
      }
		var zoomToAddress = function() {
          var address = document.getElementById('search-string_0').value;
          geocoder.geocode({
            address: address
          }, function(results, status) {
            if (status == google.maps.GeocoderStatus.OK) {
              map.setCenter(results[0].geometry.location);
              map.setZoom(9);

              // OPTIONAL: run spatial query to find results within bounds.
              var sw = map.getBounds().getSouthWest();
              var ne = map.getBounds().getNorthEast();
              var where = 'ST_INTERSECTS(' + locationColumn +
                  ', RECTANGLE(LATLNG' + sw + ', LATLNG' + ne + '))';
              layer.setOptions({
                query: {
                  select: locationColumn,
                  from: tableId,
                  where: where
                }
              });
            } else {
              window.alert('Address could not be geocoded: ' + status);
            }
          });
        };


      // Initialize the drop-down menu
      function initSelectmenu() {
        var selectMenu = document.getElementById('selector');
        for (column in COLUMN_STYLES) {
          var option = document.createElement('option');
          option.setAttribute('value', column);
          option.innerHTML = column;
          selectMenu.appendChild(option);
        }
      }

      // Apply the style to the layer & generate corresponding legend
      function applyStyle(map, layer, column) {
        var columnStyle = COLUMN_STYLES[column];
        var styles = [];

        for (var i in columnStyle) {
          var style = columnStyle[i];
          styles.push({
            where: generateWhere(column, style.min, style.max),
            polygonOptions: {
              fillColor: style.color,
              fillOpacity: style.opacity ? style.opacity : 0.8
            }
          });
        }

        layer.set('styles', styles);
      }

      // Create the where clause
      function generateWhere(columnName, low, high) {
        var whereClause = [];
        whereClause.push("'");
        whereClause.push(columnName);
        whereClause.push("' >= ");
        whereClause.push(low);
        whereClause.push(" AND '");
        whereClause.push(columnName);
        whereClause.push("' < ");
        whereClause.push(high);
        return whereClause.join('');
      }

      // Initialize the legend
      function addLegend(map) {
        var legendWrapper = document.createElement('div');
        legendWrapper.id = 'legendWrapper';
        legendWrapper.index = 1;
        map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(
            legendWrapper);
        legendContent(legendWrapper, column);
      }

      // Update the legend content
      function updateLegend(column) {
        var legendWrapper = document.getElementById('legendWrapper');
        var legend = document.getElementById('legend');
        legendWrapper.removeChild(legend);
        legendContent(legendWrapper, column);
      }
		
		 function changeMap_0() {
      var whereClause;
      var searchString = document.getElementById('search-string_0').value.replace(/'/g, "\\'");
      if (searchString != '--Select--') {
        whereClause = "'Corresponding Counties' CONTAINS IGNORING CASE '" + searchString + "'";
		  zoomToAddress();
      }
      layer.setOptions({
        query: {
          select: "col7>>1",
          from: "1-saIAOXhsY3Sc6WPvYL5SsJ_U0S94OerpG-Wt6tq",
          where: whereClause
        }
      });
    }

      // Generate the content for the legend
      function legendContent(legendWrapper, column) {
        var legend = document.createElement('div');
        legend.id = 'legend';

        var title = document.createElement('p');
        title.innerHTML = column;
        legend.appendChild(title);

        var columnStyle = COLUMN_STYLES[column];
        for (var i in columnStyle) {
          var style = columnStyle[i];

          var legendItem = document.createElement('div');

          var color = document.createElement('span');
          color.setAttribute('class', 'color');
          color.style.backgroundColor = style.color;
          legendItem.appendChild(color);

          var minMax = document.createElement('span');
          minMax.innerHTML = style.min + ' - ' + style.max;
          legendItem.appendChild(minMax);

          legend.appendChild(legendItem);
        }

        legendWrapper.appendChild(legend);
      }

      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
  </head>

 <body>
	 
    <div id="mapbox">
        <div id="map-canvas" style="height:900px;
    width:89%;"></div>
        <div style="margin-top: 10px;">
            <label class="layer-wizard-search-label">
                Corresponding Counties
                <input type="text" id="search-string_0" list="counties">
                <input type="button" onclick="changeMap_0()" value="Search">
				
				<datalist id="counties">
				<option value="Anderson">
<option value="Andrews">
<option value="Angelina">
<option value="Aransas">
<option value="Archer">
<option value="Armstrong">
<option value="Atascosa">
<option value="Austin">
<option value="Bailey">
<option value="Bandera">
<option value="Bastrop">
<option value="Baylor">
<option value="Bee">
<option value="Bell">
<option value="Bexar">
<option value="Blanco">
<option value="Borden">
<option value="Bosque">
<option value="Bowie">
<option value="Brazoria">
<option value="Brazos">
<option value="Brewster">
<option value="Briscoe">
<option value="Brooks">
<option value="Brown">
<option value="Burleson">
<option value="Burnet">
<option value="Caldwell">
<option value="Calhoun">
<option value="Callahan">
<option value="Cameron">
<option value="Camp">
<option value="Carson">
<option value="Cass">
<option value="Castro">
<option value="Chambers">
<option value="Cherokee">
<option value="Childress">
<option value="Clay">
<option value="Cochran">
<option value="Coke">
<option value="Coleman">
<option value="Collin">
<option value="Collingsworth">
<option value="Colorado">
<option value="Comal">
<option value="Comanche">
<option value="Concho">
<option value="Cooke">
<option value="Coryell">
<option value="Cottle">
<option value="Crane">
<option value="Crockett">
<option value="Crosby">
<option value="Culberson">
<option value="Dallam">
<option value="Dallas">
<option value="Dawson">
<option value="DeWitt">
<option value="Deaf Smith">
<option value="Delta">
<option value="Denton">
<option value="Dickens">
<option value="Dimmit">
<option value="Donley">
<option value="Duval">
<option value="Eastland">
<option value="Ector">
<option value="Edwards">
<option value="Ellis">
<option value="El Paso">
<option value="Erath">
<option value="Falls">
<option value="Fannin">
<option value="Fayette">
<option value="Fisher">
<option value="Floyd">
<option value="Foard">
<option value="Fort Bend">
<option value="Franklin">
<option value="Freestone">
<option value="Frio">
<option value="Gaines">
<option value="Galveston">
<option value="Garza">
<option value="Gillespie">
<option value="Glasscock">
<option value="Goliad">
<option value="Gonzales">
<option value="Gray">
<option value="Grayson">
<option value="Gregg">
<option value="Grimes">
<option value="Guadalupe">
<option value="Hale">
<option value="Hall">
<option value="Hamilton">
<option value="Hansford">
<option value="Hardeman">
<option value="Hardin">
<option value="Harris">
<option value="Harrison">
<option value="Hartley">
<option value="Haskell">
<option value="Hays">
<option value="Hemphill">
<option value="Henderson">
<option value="Hidalgo">
<option value="Hill">
<option value="Hockley">
<option value="Hood">
<option value="Hopkins">
<option value="Houston">
<option value="Howard">
<option value="Hudspeth">
<option value="Hunt">
<option value="Hutchinson">
<option value="Irion">
<option value="Jack">
<option value="Jackson">
<option value="Jasper">
<option value="Jeff Davis">
<option value="Jefferson">
<option value="Jim Hogg">
<option value="Jim Wells">
<option value="Johnson">
<option value="Jones">
<option value="Karnes">
<option value="Kaufman">
<option value="Kendall">
<option value="Kenedy">
<option value="Kent">
<option value="Kerr">
<option value="Kimble">
<option value="King">
<option value="Kinney">
<option value="Kleberg">
<option value="Knox">
<option value="La Salle">
<option value="Lamar">
<option value="Lamb">
<option value="Lampasas">
<option value="Lavaca">
<option value="Lee">
<option value="Leon">
<option value="Liberty">
<option value="Limestone">
<option value="Lipscomb">
<option value="Live Oak">
<option value="Llano">
<option value="Loving">
<option value="Lubbock">
<option value="Lynn">
<option value="McCulloch">
<option value="McLennan">
<option value="McMullen">
<option value="Madison">
<option value="Marion">
<option value="Martin">
<option value="Mason">
<option value="Matagorda">
<option value="Maverick">
<option value="Medina">
<option value="Menard">
<option value="Midland">
<option value="Milam">
<option value="Mills">
<option value="Mitchell">
<option value="Montague">
<option value="Montgomery">
<option value="Moore">
<option value="Morris">
<option value="Motley">
<option value="Nacogdoches">
<option value="Navarro">
<option value="Newton">
<option value="Nolan">
<option value="Nueces">
<option value="Ochiltree">
<option value="Oldham">
<option value="Orange">
<option value="Palo Pinto">
<option value="Panola">
<option value="Parker">
<option value="Parmer">
<option value="Pecos">
<option value="Polk">
<option value="Potter">
<option value="Presidio">
<option value="Rains">
<option value="Randall">
<option value="Reagan">
<option value="Real">
<option value="Red River">
<option value="Reeves">
<option value="Refugio">
<option value="Roberts">
<option value="Robertson">
<option value="Rockwall">
<option value="Runnels">
<option value="Rusk">
<option value="Sabine">
<option value="San Augustine">
<option value="San Jacinto">
<option value="San Patricio">
<option value="San Saba">
<option value="Schleicher">
<option value="Scurry">
<option value="Shackelford">
<option value="Shelby">
<option value="Sherman">
<option value="Smith">
<option value="Somervell">
<option value="Starr">
<option value="Stephens">
<option value="Sterling">
<option value="Stonewall">
<option value="Sutton">
<option value="Swisher">
<option value="Tarrant">
<option value="Taylor">
<option value="Terrell">
<option value="Terry">
<option value="Throckmorton">
<option value="Titus">
<option value="Tom Green">
<option value="Travis">
<option value="Trinity">
<option value="Tyler">
<option value="Upshur">
<option value="Upton">
<option value="Uvalde">
<option value="Val Verde">
<option value="Van Zandt">
<option value="Victoria">
<option value="Walker">
<option value="Waller">
<option value="Ward">
<option value="Washington">
<option value="Webb">
<option value="Wharton">
<option value="Wheeler">
<option value="Wichita">
<option value="Wilbarger">
<option value="Willacy">
<option value="Williamson">
<option value="Wilson">
<option value="Winkler">
<option value="Wise">
<option value="Wood">
<option value="Yoakum">
<option value="Young">
<option value="Zapata">
<option value="Zavala">

				</datalist>
				
            </label>
        </div>
        <select id="selector"></select>
    </div>
</body>
</html>
